# Exercise 6  - Secure Your Virtual Network Infrastructure

**Exercise 6** was to take actions to secure the network infrastructure built in the 
previous exercises. There were 4 main sub-tasks of which 2 were optional. Some of the sub-
tasks had optional components. I opted to try do them all and will outline my solution for
each below.


## Traffic Filters
This sub-task asked us to implement various filtering rules for our virtual network. I 
configured my security groups to implement the assigned rules and applied them where
appropriate. 

The file compute/main.tf has the following security groups and associations
* web_svr_sg  -> web_svr launch configuration
* app_svr_sg  -> app_svr launch configuration
* jump_svr_sg ->  jump_svr eni
* alb_sg      -> web_svr_alb ALB

## Identity and Access Managment
This sub-task specifies the creation of 3 different IAM users with unique permissions. In
addition, there is an optional component to split the deployment process between network
and compute resources.

The main.tf file in the iam sub-directory creates 3 IAM users to meet this requirement:
* aws_read_only
* s3_user
* compute_admin

The compute_admin IAM user required more complex policy which is defined in the file named
compute-admin.json.

To meet the optional split deployment, the terraform files were divided between compute
and network resources and placed in separate folders. To allow the sharing of variables
between deployments with potentially different IAM users executing them, a remote S3
Terraform backend was used.  I verified that the compute_admin IAM user could not modify 
any network resources but had access where needed.

## Application Web Firewall
To meet this sub-task, I had to extensively modify my infrastructure to be able to meet 
all the requirements to apply an AWS Web Application Firewall (WAF). A WAF requires
an Application Load Balancer (ALB) to associate it's Web ACL. An ALB requires Auto-Scaling
Groups (ASGs). ASGs require at least two subnets in two different AZs. I modified my 
infrastructure to have public and private subnets in two different AZs. I then created
ASGs for my Web Servers and Application Servers. I left my jump server as a single AZ
Deployment. Once I had all the requirements in place, I was able to configure an WAF
and Web ACL to meet the assignment requirements.

* compute/main.tf has all of the compute resources required
* screen-captures/web-page.png shows the expected web page now being served by the ALB
* screen-captures/non-existent-uri.png shows the page returned by the ALB by default when the link  is not found
* screen-captures/denied-uri.png shows the 403 Forbidden response generated by the WAF when a blocked URI is requested

## Session Logging
To enable logging of sessions to/from the SSH server, I opted to send /var/log/auth.log
messages to CloudWatch. I created the the IAM Role and attachment policy here:

iam/main.tf

The remainder of the CloudWatch configuration was on the Jump Server instance. I created
a new AMI using Packer that performed all the necessary installation and configuration.

Packer-templates/jump_svr.json

screen-captures/CloudWatch.png shows the logs being received in CloudWatch
